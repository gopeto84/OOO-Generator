<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Professional OOO Generator</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script>
    tailwind.config = {
      darkMode: 'media',
      theme: {
        extend: {
          fontFamily: { sans: ['Inter', 'sans-serif'] },
          colors: {
            brand: { 50: '#f0f9ff', 100: '#e0f2fe', 500: '#0ea5e9', 600: '#0284c7', 700: '#0369a1', 900: '#0c4a6e' }
          }
        }
      }
    }
  </script>
  <style>
    ::-webkit-scrollbar { width: 8px; height: 8px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
    .dark ::-webkit-scrollbar-thumb { background: #475569; }
    @keyframes slideUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    .animate-slide-up { animation: slideUp 0.3s ease-out forwards; }
    
    .input-base { @apply w-full rounded-lg border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 px-3 py-2 text-sm shadow-sm focus:border-brand-500 focus:ring-2 focus:ring-brand-500/50 outline-none transition-all; }
    .label-base { @apply block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5; }
    .btn-secondary { @apply px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 text-sm font-medium hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors; }
    .btn-primary { @apply px-4 py-2 rounded-lg bg-brand-600 text-white text-sm font-semibold shadow-sm hover:bg-brand-700 focus:ring-2 focus:ring-brand-500 focus:ring-offset-2 transition-all; }

    /* Accordion Styling */
    details > summary { list-style: none; }
    details > summary::-webkit-details-marker { display: none; }
    details[open] summary ~ * { animation: slideUp 0.2s ease-in-out; }
    details summary svg { transition: transform 0.2s; }
    details[open] summary svg { transform: rotate(180deg); }
  </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100 antialiased transition-colors duration-300">

  <!-- Toast -->
  <div id="toast-container" class="fixed top-5 left-1/2 -translate-x-1/2 z-50 pointer-events-none"></div>

  <div class="min-h-screen max-w-7xl mx-auto p-4 sm:p-6 lg:p-8">
    
    <!-- Header -->
    <header class="mb-8 flex flex-col sm:flex-row sm:items-end justify-between gap-4 border-b border-gray-200 dark:border-gray-700 pb-6">
      <div>
        <h1 class="text-3xl font-bold tracking-tight text-gray-900 dark:text-white">Out of Office <span class="text-brand-600">Generator</span></h1>
        <p class="mt-2 text-gray-600 dark:text-gray-400 max-w-2xl">Create polite, detailed auto-reply messages.</p>
      </div>
      <div class="flex gap-2">
         <button type="button" id="reset-app" class="text-xs text-gray-500 hover:text-red-500 underline">Reset Current Form</button>
      </div>
    </header>

    <main class="grid lg:grid-cols-12 gap-8 items-start">
      
      <!-- LEFT COLUMN: Inputs (Span 7) -->
      <section class="lg:col-span-7 space-y-6">

        <!-- Card: Saved Profiles (Presets) -->
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden">
            <div class="p-5 sm:p-6 border-b border-gray-100 dark:border-gray-700 bg-brand-50/50 dark:bg-gray-800/50 flex justify-between items-center">
                <h2 class="font-semibold text-lg text-brand-900 dark:text-brand-100 flex items-center gap-2">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"></path></svg>
                    Saved Profiles
                </h2>
            </div>
            <div class="p-5 sm:p-6">
                <div class="flex gap-3 mb-4">
                    <input id="preset-name" class="input-base" placeholder="Profile Name (e.g. 'Summer Vacation', 'Business Trip')">
                    <button id="save-preset" class="btn-primary whitespace-nowrap">Save Profile</button>
                </div>
                <div id="preset-list" class="space-y-2">
                    <!-- Presets injected here -->
                    <p class="text-xs text-gray-400 italic text-center py-2">No saved profiles yet.</p>
                </div>
            </div>
        </div>
        
        <!-- Card: Configuration -->
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden">
          <div class="p-5 sm:p-6 border-b border-gray-100 dark:border-gray-700 bg-gray-50/50 dark:bg-gray-800/50">
            <h2 class="font-semibold text-lg flex items-center gap-2">
              <svg class="w-5 h-5 text-brand-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"></path></svg>
              Details & Context
            </h2>
          </div>
          <div class="p-5 sm:p-6 space-y-5">
            
            <!-- Template Selection -->
            <div class="grid sm:grid-cols-2 gap-5">
              <div>
                <label for="template" class="label-base">Template Style</label>
                <select id="template" class="input-base">
                  <option value="general">General OOO</option>
                  <option value="holiday">National Holiday</option>
                  <option value="travel">Business Travel</option>
                  <option value="conference">Conference / Training</option>
                  <option value="medical">Medical / Personal</option>
                </select>
              </div>
              <div id="holiday-field" class="hidden animate-slide-up">
                <label for="holiday-name" class="label-base">Holiday Name</label>
                <input id="holiday-name" placeholder="e.g., Labor Day" class="input-base" />
              </div>
            </div>

            <!-- Context Note -->
            <div>
              <label for="template-note" class="label-base">Extra Context (Optional)</label>
              <input id="template-note" placeholder="e.g., I am attending the Global Summit..." class="input-base" />
            </div>

            <!-- Dates -->
            <div class="pt-4 border-t border-gray-100 dark:border-gray-700">
              <div class="flex items-center justify-between mb-3">
                <span class="text-sm font-medium text-gray-900 dark:text-white">Duration</span>
                <div class="flex gap-3">
                   <label class="flex items-center gap-2 text-xs cursor-pointer select-none">
                    <input type="checkbox" id="allDay" class="rounded border-gray-300 text-brand-600 focus:ring-brand-500">
                    <span>All Day</span>
                  </label>
                </div>
              </div>
              
              <div class="grid sm:grid-cols-2 gap-4">
                <div>
                  <label for="start-date" class="label-base">Start</label>
                  <input type="datetime-local" id="start-date" class="input-base" required />
                </div>
                <div>
                  <label for="end-date" class="label-base">End</label>
                  <input type="datetime-local" id="end-date" class="input-base" required />
                </div>
              </div>
              <p id="date-error" class="text-xs text-red-500 mt-2 hidden font-medium"></p>

              <!-- Quick Ranges -->
              <div class="mt-3 flex flex-wrap gap-2">
                <button type="button" data-range="rest-of-today" class="range-btn text-xs px-2.5 py-1.5 bg-brand-50 text-brand-700 dark:bg-brand-900/30 dark:text-brand-300 rounded hover:bg-brand-100 transition">Rest of Today</button>
                <button type="button" data-range="tomorrow" class="range-btn text-xs px-2.5 py-1.5 bg-brand-50 text-brand-700 dark:bg-brand-900/30 dark:text-brand-300 rounded hover:bg-brand-100 transition">Tomorrow</button>
                <button type="button" data-range="next-week" class="range-btn text-xs px-2.5 py-1.5 bg-brand-50 text-brand-700 dark:bg-brand-900/30 dark:text-brand-300 rounded hover:bg-brand-100 transition">Next Week</button>
              </div>
            </div>
            
            <!-- Timezone & Settings -->
            <div class="grid sm:grid-cols-2 gap-4 pt-2">
               <div>
                <label for="timezone" class="label-base">Time Zone (for Display)</label>
                <select id="timezone" class="input-base text-xs"></select>
               </div>
               <div class="flex flex-col justify-end pb-1 gap-2">
                 <label class="flex items-center gap-2 text-sm cursor-pointer select-none">
                    <input type="checkbox" id="check-email" class="rounded border-gray-300 text-brand-600 focus:ring-brand-500">
                    <span>Checking Email</span>
                  </label>
                  <label class="flex items-center gap-2 text-sm cursor-pointer select-none">
                    <input type="checkbox" id="check-teams" class="rounded border-gray-300 text-brand-600 focus:ring-brand-500">
                    <span>Checking MS Teams</span>
                  </label>
               </div>
            </div>

          </div>
        </div>

        <!-- Card: Cover & Contacts -->
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden">
          <div class="p-5 sm:p-6 border-b border-gray-100 dark:border-gray-700 bg-gray-50/50 dark:bg-gray-800/50 flex justify-between items-center">
            <h2 class="font-semibold text-lg flex items-center gap-2">
              <svg class="w-5 h-5 text-brand-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path></svg>
              Cover & Support
            </h2>
          </div>
          <div class="p-5 sm:p-6 space-y-5">
            
            <!-- Primary Contact -->
            <div id="primary-contact-group" class="bg-gray-50 dark:bg-gray-700/30 p-4 rounded-xl border border-gray-100 dark:border-gray-700">
              <h3 class="text-xs font-bold text-brand-600 dark:text-brand-400 uppercase tracking-wider mb-3">Primary Colleague</h3>
              <div class="grid sm:grid-cols-2 gap-4 mb-3">
                <div>
                  <label class="label-base">Name</label>
                  <input type="text" id="primary-name" class="input-base" placeholder="Jane Doe" />
                </div>
                <div>
                  <label class="label-base">Email</label>
                  <input type="email" id="primary-email" class="input-base" placeholder="jane@example.com" />
                </div>
              </div>
              <div>
                <label class="label-base text-brand-700 dark:text-brand-300 font-semibold">Topic / Reason for Contact</label>
                <input type="text" id="primary-reason" class="input-base py-2.5" placeholder="e.g. 'Project X inquiries' or 'Urgent Escalations'" />
              </div>
            </div>

            <!-- Secondaries -->
            <div id="secondary-container" class="space-y-4"></div>
            
            <div class="flex gap-3 pt-2">
              <button type="button" id="add-secondary" class="btn-secondary text-xs flex items-center gap-1">
                <span>+</span> Add Additional Cover Person
              </button>
               <button type="button" id="clear-contacts" class="text-xs text-red-500 hover:text-red-600 px-2">Clear Contacts</button>
            </div>

            <div class="border-t border-gray-100 dark:border-gray-700 my-4"></div>

            <!-- Emergency & Custom Footer -->
            <div class="space-y-4">
              <div>
                <label class="label-base">Cell Phone (Optional)</label>
                <input type="tel" id="cell-number" class="input-base" placeholder="+1 555 000 0000" />
              </div>
               <div>
                <label class="label-base">Additional Footer Text (Optional)</label>
                <textarea id="custom-footer" rows="2" class="input-base" placeholder="I will get back to you regarding..."></textarea>
              </div>
            </div>

          </div>
        </div>

        <!-- Card: Help & Instructions -->
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden">
          <div class="p-5 sm:p-6 border-b border-gray-100 dark:border-gray-700 bg-gray-50/50 dark:bg-gray-800/50">
            <h2 class="font-semibold text-lg flex items-center gap-2">
              <svg class="w-5 h-5 text-brand-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
              How to set your Out of Office
            </h2>
          </div>
          <div class="divide-y divide-gray-100 dark:divide-gray-700">
            
            <details class="group p-5 cursor-pointer">
              <summary class="flex items-center justify-between font-medium text-sm text-gray-900 dark:text-white hover:text-brand-600 dark:hover:text-brand-400">
                <span>Outlook — Windows/macOS (Classic)</span>
                <svg class="w-4 h-4 text-gray-400 group-hover:text-brand-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
              </summary>
              <div class="pt-3 text-sm text-gray-600 dark:text-gray-400 space-y-2 pl-1">
                <ol class="list-decimal pl-4 space-y-1">
                  <li>Open Outlook (Classic desktop app).</li>
                  <li>Go to <strong>File → Automatic Replies (Out of Office)</strong>.</li>
                  <li>Select <strong>Send automatic replies</strong>.</li>
                  <li>Check <strong>Only send during this time range</strong>, then set start and end.</li>
                  <li>Paste the message into the <strong>Inside My Organization</strong> tab (and the Outside tab).</li>
                </ol>
                <p class="text-xs italic mt-2 text-gray-500">Note: Outlook Classic auto-replies do not use a subject line.</p>
              </div>
            </details>

            <details class="group p-5 cursor-pointer">
              <summary class="flex items-center justify-between font-medium text-sm text-gray-900 dark:text-white hover:text-brand-600 dark:hover:text-brand-400">
                <span>Outlook on the Web (OWA) & New Outlook</span>
                <svg class="w-4 h-4 text-gray-400 group-hover:text-brand-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
              </summary>
              <div class="pt-3 text-sm text-gray-600 dark:text-gray-400 space-y-2 pl-1">
                <ol class="list-decimal pl-4 space-y-1">
                  <li>Open <strong>outlook.office.com</strong> (or New Outlook app).</li>
                  <li>Click the <strong>⚙️ Settings</strong> gear → search for <em>Automatic replies</em>.</li>
                  <li>Toggle <strong>Automatic replies</strong> on.</li>
                  <li>Set your start/end times and paste the message body.</li>
                  <li>Click <strong>Save</strong>.</li>
                </ol>
              </div>
            </details>

            <details class="group p-5 cursor-pointer">
              <summary class="flex items-center justify-between font-medium text-sm text-gray-900 dark:text-white hover:text-brand-600 dark:hover:text-brand-400">
                <span>Microsoft Teams</span>
                <svg class="w-4 h-4 text-gray-400 group-hover:text-brand-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
              </summary>
              <div class="pt-3 text-sm text-gray-600 dark:text-gray-400 space-y-2 pl-1">
                <ol class="list-decimal pl-4 space-y-1">
                  <li>Open Teams.</li>
                  <li>Click your profile picture → <strong>Set status message</strong>.</li>
                  <li>Click <strong>Schedule out of office</strong> at the bottom.</li>
                  <li>Toggle <strong>Turn on automatic replies</strong>.</li>
                  <li>Paste your message. Teams does not use a subject line.</li>
                  <li>Click <strong>Save</strong>.</li>
                </ol>
              </div>
            </details>

          </div>
        </div>

      </section>


      <!-- RIGHT COLUMN: Preview (Span 5) -->
      <section class="lg:col-span-5 lg:sticky lg:top-6 space-y-6">
        
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700 flex flex-col h-full">
          <div class="p-4 bg-gray-900 text-white rounded-t-xl flex justify-between items-center">
            <h2 class="font-semibold">Message Preview</h2>
            <span class="text-xs px-2 py-1 bg-white/10 rounded text-gray-300">Auto-updates</span>
          </div>
          
          <div class="p-5 flex-1 space-y-4">
            
            <!-- Subject -->
            <div class="relative group">
              <label class="label-base text-xs uppercase tracking-wide text-gray-500">Subject</label>
              <div class="flex gap-2">
                <input id="output-subject" readonly class="input-base bg-gray-50 dark:bg-gray-900 font-medium text-gray-700 dark:text-gray-200 cursor-text" />
                <button data-copy="output-subject" class="btn-secondary px-3" title="Copy Subject">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg>
                </button>
              </div>
            </div>

            <!-- Body -->
            <div class="relative flex-1 flex flex-col">
              <label class="label-base text-xs uppercase tracking-wide text-gray-500 flex justify-between">
                <span>Message Body</span>
                <span id="char-count" class="font-normal lowercase">0 chars</span>
              </label>
              <textarea id="output-body" class="w-full flex-1 min-h-[300px] rounded-lg border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-900 px-4 py-3 text-sm font-mono leading-relaxed focus:border-brand-500 focus:ring-2 focus:ring-brand-500/50 outline-none resize-none" spellcheck="false"></textarea>
              
              <div class="absolute bottom-4 right-4 flex gap-2">
                <button data-copy="output-body" class="bg-white dark:bg-gray-700 shadow-md border border-gray-200 dark:border-gray-600 rounded-full px-4 py-2 text-xs font-semibold hover:bg-gray-50 dark:hover:bg-gray-600 transition-transform active:scale-95 flex items-center gap-2 text-brand-600 dark:text-brand-400">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"></path></svg>
                  Copy Text
                </button>
              </div>
            </div>

            <!-- Actions -->
            <div class="grid grid-cols-1 gap-3 pt-2">
               <button id="open-mailto" class="btn-secondary w-full flex justify-center items-center gap-2 hover:bg-brand-50 dark:hover:bg-gray-700 text-brand-700 dark:text-brand-300 border-brand-200 dark:border-gray-600">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path></svg>
                Open Draft in Mail App
              </button>
              <button id="download-ics" class="btn-primary w-full flex justify-center items-center gap-2">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                Download Calendar Event (.ics)
              </button>
            </div>

          </div>
        </div>

      </section>
    </main>
  </div>

  <!-- JavaScript Logic -->
  <script>
    const App = (() => {
      
      const defaultState = {
        template: 'general',
        holidayName: '',
        note: '',
        start: '',
        end: '',
        allDay: false,
        timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
        checkEmail: false,
        checkTeams: false,
        primaryName: '',
        primaryEmail: '',
        primaryReason: '',
        secondaries: [], 
        cell: '',
        footer: ''
      };

      let state = { ...defaultState };
      let presets = {};
      
      const els = {
        inputs: document.querySelectorAll('input, select, textarea'),
        template: document.getElementById('template'),
        holidayField: document.getElementById('holiday-field'),
        holidayName: document.getElementById('holiday-name'),
        note: document.getElementById('template-note'),
        start: document.getElementById('start-date'),
        end: document.getElementById('end-date'),
        allDay: document.getElementById('allDay'),
        timezone: document.getElementById('timezone'),
        checkEmail: document.getElementById('check-email'),
        checkTeams: document.getElementById('check-teams'),
        pName: document.getElementById('primary-name'),
        pEmail: document.getElementById('primary-email'),
        pReason: document.getElementById('primary-reason'),
        secContainer: document.getElementById('secondary-container'),
        addSecBtn: document.getElementById('add-secondary'),
        clearContactsBtn: document.getElementById('clear-contacts'),
        cell: document.getElementById('cell-number'),
        footer: document.getElementById('custom-footer'),
        outSubject: document.getElementById('output-subject'),
        outBody: document.getElementById('output-body'),
        dlIcs: document.getElementById('download-ics'),
        openMailto: document.getElementById('open-mailto'),
        dateError: document.getElementById('date-error'),
        resetBtn: document.getElementById('reset-app'),
        ranges: document.querySelectorAll('.range-btn'),
        presetName: document.getElementById('preset-name'),
        savePresetBtn: document.getElementById('save-preset'),
        presetList: document.getElementById('preset-list')
      };

      const Utils = {
        pad: (n) => String(n).padStart(2, '0'),
        formatDate: (dStr, tz, options) => {
          if(!dStr) return '';
          return new Date(dStr).toLocaleDateString('en-US', { timeZone: tz, timeZoneName: 'short', ...options });
        },
        formatTime: (dStr, tz) => {
          if(!dStr) return '';
          return new Date(dStr).toLocaleTimeString('en-US', { timeZone: tz, hour: 'numeric', minute: '2-digit' });
        },
        toLocalInput: (d) => {
           const offsetMs = d.getTimezoneOffset() * 60000;
           const localISOTime = (new Date(d - offsetMs)).toISOString().slice(0, -1);
           return localISOTime.slice(0, 16);
        },
        showToast: (msg, type='success') => {
          const c = document.getElementById('toast-container');
          const el = document.createElement('div');
          const bg = type === 'error' ? 'bg-red-600' : 'bg-gray-900';
          el.className = `${bg} text-white px-4 py-2 rounded shadow-lg mb-2 text-sm font-medium animate-slide-up`;
          el.textContent = msg;
          c.appendChild(el);
          setTimeout(() => el.remove(), 3000);
        },
        isSameDay: (d1Str, d2Str, tz) => {
          if (!d1Str || !d2Str) return false;
          const d1 = new Date(d1Str).toLocaleDateString('en-US', { timeZone: tz });
          const d2 = new Date(d2Str).toLocaleDateString('en-US', { timeZone: tz });
          return d1 === d2;
        }
      };

      const Generator = {
        build: () => {
          const tpl = state.template;
          const hasDates = state.start && state.end;
          
          // --- 1. INTRO & DATES ---
          let intro = "Thank you for your email.";
          let reason = "I am away from the office"; 

          if (tpl === 'holiday') reason = `I am out of the office for ${state.holidayName || 'the holiday'}`;
          if (tpl === 'travel') reason = "I am traveling for business";
          if (tpl === 'conference') reason = "I am currently attending a conference";
          if (tpl === 'medical') reason = "I am out of the office on personal leave";

          let dateStr = "";
          
          if (hasDates) {
            const tz = state.timezone;
            const sDate = Utils.formatDate(state.start, tz, { weekday: 'long', month:'long', day:'numeric' });
            const eDate = Utils.formatDate(state.end, tz, { weekday: 'long', month:'long', day:'numeric' });
            const sTime = Utils.formatTime(state.start, tz);
            const eTime = Utils.formatTime(state.end, tz);
            const sameDay = Utils.isSameDay(state.start, state.end, tz);

            if (state.allDay) {
               if (sameDay) dateStr = ` on ${sDate}`;
               else dateStr = ` starting ${sDate} until ${eDate}`;
            } else {
               if (sameDay) {
                 dateStr = ` on ${sDate} from ${sTime} to ${eTime}`;
               } else {
                 dateStr = ` from ${sDate} at ${sTime} until ${eDate} at ${eTime}`;
               }
            }
          }

          let mainSentence = `${reason}${dateStr}.`;
          if (state.note) {
             mainSentence += ` ${state.note}`;
             if (!mainSentence.endsWith('.') && !mainSentence.endsWith('!')) mainSentence += '.';
          }

          // --- 2. COMMUNICATION CHANNELS ---
          let comms = [];
          if (state.checkEmail) comms.push("email");
          if (state.checkTeams) comms.push("MS Teams");
          
          let accessStr = "";
          if (comms.length > 0) {
             const joined = comms.join(' and ');
             accessStr = `\n\nI will be checking ${joined}. Please note that my responses will be delayed.`;
          }

          // --- 3. CONTACTS ---
          let contactParts = [];
          
          // Primary
          if (state.primaryName || state.primaryEmail) {
             let line = "";
             if (state.primaryReason) {
                line = `For matters regarding ${state.primaryReason}, please contact my colleague ${state.primaryName}`;
             } else {
                line = `My primary colleague covering for me is ${state.primaryName}`;
             }
             
             if (state.primaryEmail) line += ` (${state.primaryEmail})`;
             line += `.`;
             contactParts.push(line);
          }

          // Secondaries
          state.secondaries.forEach(sec => {
             if(sec.name) {
               let reasonText = sec.reason ? ` regarding ${sec.reason}` : '';
               contactParts.push(`Please direct inquiries${reasonText} to ${sec.name}${sec.email ? ` (${sec.email})` : ''}.`);
             }
          });

          let contactStr = contactParts.length > 0 ? `\n\n${contactParts.join('\n')}` : "";

          // --- 4. CELL PHONE ---
          let cellStr = "";
          if (state.cell) {
             cellStr = `\n\nIf your matter is urgent, you can reach me at ${state.cell}.`;
          }

          // --- 5. FOOTER ---
          let footerStr = "";
          if (state.footer) {
             footerStr = `\n\n${state.footer}`;
          }

          // --- ASSEMBLY ---
          return `${intro} ${mainSentence}${accessStr}${contactStr}${cellStr}${footerStr}\n\nI'll get back to you when I return,`;
        },

        buildSubject: () => {
          const prefix = state.template === 'holiday' 
            ? `OOO: ${state.holidayName || 'Holiday'}` 
            : 'Out of Office';
            
          if (state.end) {
            const returnDate = Utils.formatDate(state.end, state.timezone, { month: 'short', day: 'numeric' });
            const cleanDate = returnDate.split(',').slice(0,2).join(',').trim(); 
            return `${prefix} - Returning ${cleanDate}`;
          }
          return prefix;
        },

        buildICS: () => {
           if (!state.start || !state.end) return null;
           const formatDate = (isoStr) => isoStr.replace(/[-:]/g, '').split('.')[0] + 'Z';
           const now = formatDate(new Date().toISOString());
           const startUTC = formatDate(new Date(state.start).toISOString());
           const endUTC = formatDate(new Date(state.end).toISOString());
           const desc = els.outBody.value.replace(/\n/g, '\\n');
           
           return [
             'BEGIN:VCALENDAR',
             'VERSION:2.0',
             'PRODID:-//OOO Generator//EN',
             'BEGIN:VEVENT',
             `UID:${Date.now()}@ooogen`,
             `DTSTAMP:${now}`,
             `DTSTART:${startUTC}`,
             `DTEND:${endUTC}`,
             `SUMMARY:${els.outSubject.value}`,
             `DESCRIPTION:${desc}`,
             'X-MICROSOFT-CDO-BUSYSTATUS:OOF',
             'END:VEVENT',
             'END:VCALENDAR'
           ].join('\r\n');
        }
      };

      const Logic = {
        init: () => {
          // Timezones
          const userTz = state.timezone;
          try {
            const tzs = Intl.supportedValuesOf('timeZone');
            tzs.forEach(tz => {
              const opt = document.createElement('option');
              opt.value = tz;
              opt.textContent = tz.replace(/_/g, ' ');
              if (tz === userTz) opt.selected = true;
              els.timezone.appendChild(opt);
            });
          } catch(e) {
            els.timezone.innerHTML = '<option value="UTC">UTC</option>';
          }

          // Load Saved Presets
          const savedPresets = localStorage.getItem('ooo_presets');
          if(savedPresets) { presets = JSON.parse(savedPresets); }
          Logic.renderPresetList();

          // Load Current State
          const saved = localStorage.getItem('ooo_state_v5');
          if (saved) {
             const parsed = JSON.parse(saved);
             state = { ...defaultState, ...parsed };
             Logic.applyStateToDom();
          }

          Logic.updateUI();
          Logic.bindEvents();
        },

        save: () => {
           localStorage.setItem('ooo_state_v5', JSON.stringify(state));
        },

        savePreset: () => {
          const name = els.presetName.value.trim();
          if(!name) { Utils.showToast('Please enter a profile name.', 'error'); return; }
          
          presets[Date.now()] = { name, data: { ...state } };
          localStorage.setItem('ooo_presets', JSON.stringify(presets));
          els.presetName.value = '';
          Logic.renderPresetList();
          Utils.showToast('Profile saved!');
        },

        loadPreset: (id) => {
          if(presets[id]) {
            state = { ...presets[id].data };
            Logic.applyStateToDom();
            Logic.updateUI();
            Logic.save();
            Utils.showToast(`Loaded "${presets[id].name}"`);
          }
        },

        deletePreset: (id) => {
          if(confirm('Delete this profile?')) {
             delete presets[id];
             localStorage.setItem('ooo_presets', JSON.stringify(presets));
             Logic.renderPresetList();
          }
        },

        renderPresetList: () => {
           els.presetList.innerHTML = '';
           const keys = Object.keys(presets).reverse(); // Newest first
           if(keys.length === 0) {
              els.presetList.innerHTML = '<p class="text-xs text-gray-400 italic text-center py-2">No saved profiles yet.</p>';
              return;
           }
           
           keys.forEach(key => {
              const p = presets[key];
              const div = document.createElement('div');
              div.className = "flex items-center justify-between p-2 rounded bg-gray-50 dark:bg-gray-700/50 border border-gray-100 dark:border-gray-600";
              div.innerHTML = `
                <span class="text-sm font-medium text-gray-700 dark:text-gray-200 truncate">${p.name}</span>
                <div class="flex gap-2">
                   <button class="text-xs text-brand-600 hover:text-brand-800 font-medium load-preset" data-id="${key}">Load</button>
                   <button class="text-xs text-gray-400 hover:text-red-500 delete-preset" data-id="${key}">✕</button>
                </div>
              `;
              els.presetList.appendChild(div);
           });

           document.querySelectorAll('.load-preset').forEach(b => b.addEventListener('click', (e) => Logic.loadPreset(e.target.dataset.id)));
           document.querySelectorAll('.delete-preset').forEach(b => b.addEventListener('click', (e) => Logic.deletePreset(e.target.dataset.id)));
        },

        applyStateToDom: () => {
             els.template.value = state.template;
             els.holidayName.value = state.holidayName;
             els.note.value = state.note;
             els.start.value = state.start;
             els.end.value = state.end;
             els.allDay.checked = state.allDay;
             els.timezone.value = state.timezone;
             els.checkEmail.checked = state.checkEmail;
             if(els.checkTeams) els.checkTeams.checked = state.checkTeams;
             els.pName.value = state.primaryName;
             els.pEmail.value = state.primaryEmail;
             els.pReason.value = state.primaryReason;
             els.cell.value = state.cell;
             els.footer.value = state.footer;
             
             els.secContainer.innerHTML = '';
             state.secondaries.forEach(s => Logic.addSecondaryInput(s));
        },

        updateUI: () => {
          els.holidayField.classList.toggle('hidden', state.template !== 'holiday');
          
          const validDates = !state.start || !state.end || new Date(state.end) > new Date(state.start);
          
          if (!validDates && state.start && state.end) {
             els.dateError.textContent = "End date/time must be after start.";
             els.dateError.classList.remove('hidden');
             els.dlIcs.classList.add('opacity-50', 'pointer-events-none');
          } else {
             els.dateError.classList.add('hidden');
             els.dlIcs.classList.remove('opacity-50', 'pointer-events-none');
          }

          const subject = Generator.buildSubject();
          const body = Generator.build();
          
          if(els.outSubject.value !== subject) els.outSubject.value = subject;
          els.outBody.value = body;
          document.getElementById('char-count').textContent = `${body.length} chars`;
        },

        addSecondaryInput: (data = {name:'', email:'', reason:''}) => {
           const id = Date.now() + Math.random();
           const div = document.createElement('div');
           div.className = "bg-gray-50 dark:bg-gray-700/30 p-4 rounded-xl border border-gray-100 dark:border-gray-700 space-y-2 animate-slide-up relative group";
           div.dataset.id = id;
           div.innerHTML = `
             <h3 class="text-xs font-bold text-brand-600 dark:text-brand-400 uppercase tracking-wider mb-3">Additional Cover Person</h3>
             <button type="button" class="absolute top-2 right-2 text-gray-400 hover:text-red-500 remove-sec">
               <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
             </button>
             <div class="grid sm:grid-cols-2 gap-4 mb-3">
               <div>
                  <label class="label-base">Name</label>
                  <input type="text" class="input-base sec-name" placeholder="Colleague Name" value="${data.name}">
               </div>
               <div>
                  <label class="label-base">Email</label>
                  <input type="email" class="input-base sec-email" placeholder="Email" value="${data.email}">
               </div>
             </div>
             <div>
                <label class="label-base text-brand-700 dark:text-brand-300 font-semibold">Topic / Reason for Contact</label>
                <input type="text" class="input-base py-2.5 sec-reason" placeholder="e.g. 'Billing' or 'Operations'" value="${data.reason}">
             </div>
           `;
           els.secContainer.appendChild(div);
           
           const inputs = div.querySelectorAll('input');
           inputs.forEach(i => i.addEventListener('input', Logic.scrapeSecondaries));
           div.querySelector('.remove-sec').addEventListener('click', () => {
             div.remove();
             Logic.scrapeSecondaries();
           });
        },

        scrapeSecondaries: () => {
           const blocks = els.secContainer.children;
           const secs = [];
           for (let b of blocks) {
              secs.push({
                name: b.querySelector('.sec-name').value,
                email: b.querySelector('.sec-email').value,
                reason: b.querySelector('.sec-reason').value
              });
           }
           state.secondaries = secs;
           Logic.updateUI();
           Logic.save();
        },

        handleInput: (e) => {
           const id = e.target.id;
           const val = e.target.type === 'checkbox' ? e.target.checked : e.target.value;
           
           if(id === 'template') state.template = val;
           if(id === 'holiday-name') state.holidayName = val;
           if(id === 'template-note') state.note = val;
           if(id === 'start-date') state.start = val;
           if(id === 'end-date') state.end = val;
           if(id === 'allDay') state.allDay = val;
           if(id === 'timezone') state.timezone = val;
           if(id === 'check-email') state.checkEmail = val;
           if(id === 'check-teams') state.checkTeams = val;
           if(id === 'primary-name') state.primaryName = val;
           if(id === 'primary-email') state.primaryEmail = val;
           if(id === 'primary-reason') state.primaryReason = val;
           if(id === 'cell-number') state.cell = val;
           if(id === 'custom-footer') state.footer = val;

           Logic.updateUI();
           Logic.save();
        },

        setRange: (type) => {
           const now = new Date();
           let s = new Date();
           let e = new Date();
           
           s.setHours(9,0,0,0);
           e.setHours(17,0,0,0);

           if (type === 'rest-of-today') {
              s = new Date(); 
              if (s.getHours() >= 17) { 
                 s.setDate(s.getDate() + 1);
                 s.setHours(9,0,0,0);
              }
              e.setHours(17,0,0,0);
              e.setDate(s.getDate());
              e.setFullYear(s.getFullYear());
              e.setMonth(s.getMonth());
           } else if (type === 'tomorrow') {
              s.setDate(now.getDate() + 1);
              e.setDate(now.getDate() + 1);
           } else if (type === 'next-week') {
              const day = now.getDay();
              const dist = 1 + 7 - day; 
              s.setDate(now.getDate() + dist);
              e.setDate(s.getDate() + 4); 
           }

           els.start.value = Utils.toLocalInput(s);
           els.end.value = Utils.toLocalInput(e);
           state.start = els.start.value;
           state.end = els.end.value;
           Logic.updateUI();
           Logic.save();
        },

        bindEvents: () => {
          const inputs = [els.template, els.holidayName, els.note, els.start, els.end, els.allDay, els.timezone, els.checkEmail, els.checkTeams, els.pName, els.pEmail, els.pReason, els.cell, els.footer];
          inputs.forEach(el => { if(el) el.addEventListener('input', Logic.handleInput); });

          els.addSecBtn.addEventListener('click', () => { Logic.addSecondaryInput(); Logic.scrapeSecondaries(); });
          els.clearContactsBtn.addEventListener('click', () => {
            els.secContainer.innerHTML = '';
            els.pName.value = ''; els.pEmail.value = ''; els.pReason.value = '';
            Logic.handleInput({target: els.pName}); 
            Logic.scrapeSecondaries();
          });

          els.savePresetBtn.addEventListener('click', Logic.savePreset);

          els.ranges.forEach(btn => {
             btn.addEventListener('click', () => Logic.setRange(btn.dataset.range));
          });

          document.querySelectorAll('button[data-copy]').forEach(btn => {
             btn.addEventListener('click', (e) => {
               const targetId = btn.dataset.copy;
               const text = document.getElementById(targetId).value;
               navigator.clipboard.writeText(text).then(() => {
                 const originalHtml = btn.innerHTML;
                 btn.innerHTML = `<span class="text-green-500 font-bold">Copied!</span>`;
                 setTimeout(() => btn.innerHTML = originalHtml, 2000);
               });
             });
          });

          els.dlIcs.addEventListener('click', () => {
             const icsData = Generator.buildICS();
             if(!icsData) { Utils.showToast('Please set valid dates first.', 'error'); return; }
             const blob = new Blob([icsData], { type: 'text/calendar' });
             const url = URL.createObjectURL(blob);
             const a = document.createElement('a');
             a.href = url;
             a.download = 'ooo_event.ics';
             document.body.appendChild(a);
             a.click();
             document.body.removeChild(a);
             Utils.showToast('Calendar event downloaded');
          });

          els.openMailto.addEventListener('click', () => {
             const subj = encodeURIComponent(els.outSubject.value);
             const body = encodeURIComponent(els.outBody.value);
             window.open(`mailto:?subject=${subj}&body=${body}`, '_blank');
          });
          
          els.resetBtn.addEventListener('click', () => {
            if(confirm('Reset the current form? (Saved presets will remain)')) {
               localStorage.removeItem('ooo_state_v5');
               location.reload();
            }
          });
        }
      };

      return Logic;
    })();

    document.addEventListener('DOMContentLoaded', App.init);
  </script>
</body>
</html>
